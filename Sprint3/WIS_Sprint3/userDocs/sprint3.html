<!DOCTYPE html>
<html>

<head>
    <title>sprint3.md</title>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    
<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

html,footer,header{
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Custom MD PDF CSS
 */
html,footer,header{
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";

 }
body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>
<link rel="stylesheet" href="file:///home/alessio/hdd/Projects/WasteIncineratorService/R%3A%5C2.Travail%5C1.Enseignement%5CCours%5C_1.Outils%5C2.Developpement%5C1.SCSS%5Cmain.css" type="text/css"><link rel="stylesheet" href="file:///home/alessio/hdd/Projects/WasteIncineratorService/D%3A%5Crdaros%5CCours%5C_1.Outils%5C2.Developpement%5C1.SCSS%5Cmain.css" type="text/css">
</head>

<body>
    <link rel="stylesheet" type="text/css" href="resources/css/custom.css" />
<h1 id="waste-incinerator-service">Waste Incinerator Service</h1>
<h2 id="sprint-info">Sprint info</h2>
<table>
<tr><th>Sprint name</th><td>Sprint 3</td></tr>
<tr><th>Previous sprint</th><td><a href="/WIS_Sprint2">Sprint 2</a></td></tr>
<tr><th>QAK model</th><td><a href="../src/sprint3.qak">sprint3.qak</a></td></tr>
<tr><th>Developed by</th><td>Alessio Benenati<br/>Giulia Fattori</td></tr>
<tr><th>Repo Site</th><td><a href="https://github.com/b3nny01/WasteIncineratorService">WasteIncineratorService</td><tr>
</table>
<h2 id="sprint-starting-condition-and-goals">Sprint Starting Condition and Goals</h2>
<p>In the previous sprint, we focused on the MonitoringDevice and how to connect its physical components to our system.<br/><br>
In this sprint, we aim to connect our fully working system to a web interface to show users all the steps taken by OpRobot and let them interact directly with it; on top of that, we will dockerize all of our sprints in different containers for easier activation.</p>
<h2 id="requirements">Requirements</h2>
<p>In the previous sprint review, to test the virtual environment application more easily, the client asked to add two buttons to the user interface, one to increase the number of RP in WasteStorage, the other to free AshStorage.</p>
<h2 id="problem-analysis">Problem Analysis</h2>
<h3 id="mqtt">MQTT</h3>
<p>All the previous sprints used the qak function <em>updateResource</em> to emit updates that are then read by the observers; this method introduces quite a strong coupling between the different components of the system.<br/><br>
Another possibility is using a publish/subscribe protocol, like <strong>MQTT</strong>, that introduces an intermediary between the communicating qak actors and grants a <strong>higher degree of separation</strong> throughout the entire system, as well as more robust communication.</p>
<h3 id="interface">Interface</h3>
<p>Following the system requirements, a <strong>ServiceStatusGui</strong> is needed to display and update the status of two storages, the incinerator, and the OpRobot; on top of that, it must give the user the possibility to increase the number of RP in WasteStorage and empty completely the AshStorage.<br/><br>
Consequently, the Gui needs <strong>both to receive and send information</strong> from and to the qak system, which means they require a common communication protocol to exchange this data in real-time. The Gui also has to display all the required information on a <strong>graphic interface</strong>, using different intuitive icons.</p>
<h2 id="project">Project</h2>
<h3 id="project-architecture">Project Architecture</h3>
<p>At the end of the sprint2 the system architecture was the following:<br>
<img src="resources/imgs/wis_system_2.png" width="1100px"/><br>
<Img src="resources/imgs/monitoring_device_2.png" width="1100px"></p>
<p>Based on the Problem Analysis carried out previously, we upgraded the executable version of the system covering the discussed features;<br/> we attach here a visual representation of the new system architecture:<br>
<img src="resources/imgs/wis_system_3.png" width="1100px"/><br>
<Img src="resources/imgs/monitoring_device_3.png" width="1100px"></p>
<p>As can be seen, the adoption of the MQTT protocol allowed a greater level of independence, in particular, the WIS does not need anymore to know the MonitoringDevice ip address, while the MonitoringDevice still needs the main host ip address to communicate with the MQTT broker, but it can be injected at runtime by the SystemConfigurator using the <code>monitoring_device.properties</code> file.</p>
<h2 id="implementation">Implementation</h2>
<h3 id="docker">Docker</h3>
<p>To simplify the application deployment, we decided to <strong>dockerize all the components of the system</strong> but the MonitoringDevice, since it needs to run on an embedded device.<br/><br>
Here we attach the resulting deployment architecture:<br>
<img src="resources/imgs/wis_deployment_3.jpg"></p>
<p>The following schema instead shows the mock deployment architecture:<br>
<img src="resources/imgs/wis_mock_deployment_3.jpg"></p>
<h3 id="mqtt-broker">MQTT Broker</h3>
<p>A <strong>MQTT Broker</strong> is needed to implement the MQTT protocol. We decided to use a Mosquitto local broker, as it is easily integrated alongside our qak architecture; this broker is also used to implement communication between the ServiceStatusGui and the qak system, more details will be given in the next section.<br/><br>
The actors that need to send or receive messages connect to the broker and then either <strong>subscribe to or publish updates on specific topics</strong>:</br></p>
<ul>
<li><strong>actor_state</strong>: topic used by the actors to publish updates about their own status.</li>
<li><strong>system_state</strong>: topic used by WIS to expose the real-time state of the whole system.</li>
<li><strong>mock_cmd</strong>: topic used by Backend to send the command (increase RP or empty AshStorage) when a button is pressed.</li>
</ul>
<h3 id="servicestatusgui">ServiceStatusGui</h3>
<p>We decided to split our Gui into two projects:<br/></p>
<ul>
<li><strong>Backend</strong>: it manages all communication between the Gui and the WIS System, using the MQTT protocol.</li>
<li><strong>Frontend</strong>: React Application showing the console. It communicates with Backend via WebSocket.</li>
</ul>
<h2 id="test-plan">Test Plan</h2>
<p>For this sprint, we switched to a new QAK tester project, TEST_Sprint3, instead of using the JUnit library. This change simplifies communication with all system components.</p>
<p><strong>Test Project</strong>: <a href="../../TEST_Sprint3/src/wis_tester.qak">wis_tester</a></p>
<table>
<tr>
  <th><b>Test Name</b></th>
  <th><b>Initial Condition</b></th>
  <th><b>Expected Behavior</b></th>
</tr>
<tr>
  <td><b>test_check_n1</b></td>
  <td>WasteStorage contains 5 RP, AshStorge is empty, nobody empties AshStorage, Incinerator is inactive</td>
  <td>Once the OpRobot check the system state for the first time, the the WasteStorage contains 5RP, the Incinerator is active, and the AshStorage is empty</td>
</tr>
<tr>
  <td><b>test_check_n2</b></td>
  <td>test_check_n1 is ok</td>
  <td>Once the OpRobot check the system state for the second time, the the WasteStorage contains 4RP, the Incinerator is active, and the AshStorage is 1/3 full</td>
</tr>
<tr>
  <td><b>test_check_n3</b></td>
  <td>test_check_n2 is ok</td>
  <td>Once the OpRobot check the system state for the second time, the the WasteStorage contains 3RP, the Incinerator is active, and the AshStorage is 2/3 full</td>
</tr>
<tr>
  <td><b>test_check_n4</b></td>
  <td>test_check_n3 is ok</td>
  <td>Once the OpRobot check the system state for the second time, the the WasteStorage contains 3RP, the Incinerator is active, and the AshStorage is full</td>
</tr>
</table>
<h2 id="usage">Usage</h2>
<h3 id="system-activation">System Activation</h3>
<p>Then, you have to activate the monitoring device, to do so connect to your Raspberry via <code>ssh</code> then move inside the <code>monitoring_device-1.0/bin</code> folder, and run</p>
<pre class="hljs"><code><div>./monitoring_device
</div></code></pre>
<p>Lastly, you have to activate the WIS system by opening a third terminal inside the <code>WIS_Sprint3</code> folder and running</p>
<pre class="hljs"><code><div>docker compose up
</div></code></pre>
<p><strong>N.B.</strong> Type <code>docker compose -f docker-compose-mock.yaml up</code> if you want to launch the mock version of the application, or <code>docker compose -f docker-compose-test.yaml up | grep tester-1</code> if you want to launch the test configured system</p>
<h3 id="monitoring-device">Monitoring Device</h3>
<p>Firstly, you will need:</p>
<ul>
<li>a raspberry (we used a raspberry PI 3+)</li>
<li>a led</li>
<li>a sonar (HCSR04)</li>
<li>a 220ohm resistor</li>
<li>a breadboard</li>
</ul>
<p>You will have to assemble those elements following this wiring scheme:</p>
<img src="resources/imgs/rasp_scheme.jpeg">
<p>Then you will have to deploy the Monitoring Device control software, to do so, open a terminal inside the <code>MD_Sprint3</code> folder run</p>
<pre class="hljs"><code><div>gradlew build
</div></code></pre>
<p>After that, copy the <code>MD_Sprint3/build/distributions/monitoring_device-1.0.zip</code> folder inside the Raspberry (for instance using <code>scp</code>) and unzip it</p>

</body>

</html>